{{ $folder := .Get "folder" }}
{{ $tags := split (.Get "tags") "," }}
{{ $files := readDir $folder }}
{{ $type := .Get "type" }}
{{ $baseURL := $.Site.BaseURL}}

{{ range $files }}
  {{ $file := printf "%s/%s" $folder .Name }}
  {{ $file = replace $file "content/" "" }}
  {{ $page := site.GetPage $file }}

  {{ $pageTags := $page.Params.tags }}

  {{ if $page }}

    {{ $allTagsPresent := true }}
    {{ range $pageTags }}
      {{ if not (in $tags .) }}
        {{ $allTagsPresent = false }}
      {{ end }}
    {{ end }}

    {{ if $allTagsPresent }}

      {{ if eq $type "html" }}
        {{ $file | readFile | safeHTML }}
      {{ else if eq $type "page" }}
        {{ partial "showPageTags" (dict "pageTags" $pageTags "baseURL" $baseURL) }}
        {{ with $page }}{{ .Content }}{{ end }}
        <br>
        <hr>
        <br>
      {{ else }}
        {{ $file | readFile | $.Page.RenderString }}
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}
