{{- $folder := .Get "folder" -}}
{{- $tags := split (.Get "tags") "," -}}
{{- $type := .Get "type" -}}
{{- $baseURL := $.Site.BaseURL -}}

{{- $allFiles := partial "readDirRecursive.html" (dict "path" $folder "allFiles" (slice)) -}}

{{- range $allFiles -}}
  {{- $file := replace . "content/" "" -}}
  {{- $page := site.GetPage $file -}}
  {{- $pageTags := $page.Params.tags -}}

  {{- if $page -}}
    {{- $allTagsPresent := true -}}
    {{- range $pageTags -}}
      {{- if not (in $tags .) -}}
        {{- $allTagsPresent = false -}}
      {{- end -}}
    {{- end -}}

    {{- if $allTagsPresent -}}
      {{- if eq $type "html" -}}
        {{- $file | readFile | safeHTML -}}
      {{- else if eq $type "page" -}}
        {{- partial "showPageTags" (dict "pageTags" $pageTags "baseURL" $baseURL) -}}
        {{- with $page -}}
          {{- .Content -}}
        {{- end -}}
        <br>
        <hr>
        <br>
      {{- else -}}
        {{- $file | readFile | $.Page.RenderString -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
