{{- $folder := .Get "folder" -}}
{{- $tags := split (.Get "tags") "," -}}
{{- $type := .Get "type" -}}
{{- $baseURL := $.Site.BaseURL -}}
{{- $recursive := default false (.Get "recursive") -}}
{{- $strict := default false (.Get "strict") -}}
{{- $allFiles := slice -}}

{{- if $recursive -}}
  {{- $allFiles = partial "readDirRecursive" (dict "path" $folder "allFiles" $allFiles) -}}
{{- else -}}
  {{- $entries := readDir $folder -}}
  {{- range $entries -}}
    {{- $allFiles = $allFiles | append (printf "%s/%s" $folder .Name) -}}
  {{- end -}}
{{- end -}}

{{- range $allFiles -}}
  {{- $file := . -}}
  {{- $page := site.GetPage $file -}}
  {{- $pageTags := $page.Params.tags -}}

  {{- if $page -}}
    {{- $allTagsPresent := true -}}

    {{- if $strict -}}
      {{- if not (eq (len $tags) (len $pageTags)) -}}
        {{- $allTagsPresent = false -}}
      {{- else -}}
        {{- range $tags -}}
          {{- if not (in $pageTags .) -}}
            {{- $allTagsPresent = false -}}
          {{- end -}}
        {{- end -}}
      {{- end -}}
    {{- else -}}
      {{- range $tags -}}
        {{- if not (in $pageTags .) -}}
          {{- $allTagsPresent = false -}}
        {{- end -}}
      {{- end -}}
    {{- end -}}

    {{- if $allTagsPresent -}}
      {{- if eq $type "html" -}}
        {{- $file | readFile | safeHTML -}}
      {{- else if eq $type "page" -}}
        {{- partial "showPageTags" (dict "pageTags" $pageTags "baseURL" $baseURL) -}}
        {{- with $page -}}
          {{- .Content -}}
        {{- end -}}
        <br>
        <hr>
        <br>
      {{- else -}}
        {{- $file | readFile | $.Page.RenderString -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
